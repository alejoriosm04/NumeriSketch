{% extends "base/base.html" %} 
{% load static %}
{% block content %}

<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;700&display=swap" rel="stylesheet">

<!-- Page Content -->
<div class="container mt-5 pt-5">
  <div class="row justify-content-center">
    <div class="col-lg-8 text-center">
      <!-- Título -->
      <h1 class="mt-5 section-t">Método de Bisección</h1>
      <p class="lead">
        Es un procedimiento numérico utilizado para encontrar raíces de funciones continuas. Se basa en dividir repetidamente un intervalo en dos mitades y seleccionar la subparte donde cambia el signo de la función, garantizando la existencia de una raíz en ese subintervalo. Es un método simple y robusto, aunque puede ser más lento que otros métodos.
      </p>
    </div>
  </div>

  <!-- Formulario -->
  <div class="row justify-content-center mt-4">
    <div class="col-lg-8">
      <div class="card p-4 shadow-lg">
        <form method="POST" action="{% url 'bisection' %}">
          {% csrf_token %}
          <div class="form-group mb-3">
            <div class="row">
              <div class="col">
                <label for="xi">X0:</label>
                <input type="number" id="xi" name="xi" class="form-control rounded shadow-sm" step="any"
                       placeholder="Ejemplo: -2" value="{{ xi|default:'' }}" required>
              </div>
              <div class="col">
                <label for="xs">Xs:</label>
                <input type="number" id="xs" name="xs" class="form-control rounded shadow-sm" step="any"
                       placeholder="Ejemplo: 2" value="{{ xs|default:'' }}" required>
              </div>
            </div>
          </div>
          <div class="form-group mb-3">
            <label for="tol">Tolerancia:</label>
            <input type="number" id="tol" name="tol" class="form-control rounded shadow-sm" step="any"
                   placeholder="Ejemplo: 0.5e-5" value="{{ tol|default:'' }}" required>
          </div>
          <div class="form-group mb-3">
            <label for="niter">Número de iteraciones:</label>
            <input type="number" id="niter" name="niter" class="form-control rounded shadow-sm" step="any"
                   placeholder="Ejemplo: 100" value="{{ niter|default:'' }}" required>
          </div>
          <div class="form-group mb-3">
            <label for="fx">Función f(x):</label>
            <input type="text" id="fx" name="fun" class="form-control rounded shadow-sm"
                   placeholder="Ejemplo: x^3 - 2*x + 1" value="{{ fun|default:'' }}" required>
          </div>
          <div class="form-group mb-3">
            <label for="precision_type">Tipo de Precisión:</label>
            <select id="precision_type" name="precision_type" class="form-control shadow-sm">
              <option value="significant_figures" {% if precision_type == "significant_figures" %}selected{% endif %}>Cifras Significativas</option>
              <option value="decimal_places" {% if precision_type == "decimal_places" %}selected{% endif %}>Decimales Correctos</option>
            </select>
          </div>
          <div class="form-group mb-3">
            <label for="precision_value">Número de Cifras/Decimales:</label>
            <input type="number" id="precision_value" name="precision_value" class="form-control rounded shadow-sm"
                   step="1" placeholder="Ejemplo: 5" value="{{ precision_value|default:'' }}" required>
          </div>

          <!-- Botón de calcular -->
          <button type="submit" class="btn btn-primary btn-lg w-100 shadow-sm">Calcular</button>

          <!-- Botón de limpiar (reset) -->
          <button type="reset" class="btn btn-secondary btn-lg w-100 mt-3 shadow-sm">Limpiar</button>
        </form>

      </div>
    </div>
  </div>

  <!-- Resultados -->
  <div class="row justify-content-center mt-5">
    <div class="col-lg-8">
      <h2 class="mt-4">Resultados:</h2>
      <div class="card p-3 shadow-sm">
        <h4><b>F(x):</b> {% if fx %} {{fx}} {% endif%}</h4>

        <!-- Mensajes -->
        {% if error %}
        <div class="alert alert-danger mt-3">
          {% for message in msg %}
          <p>{{ message }}</p>
          {% endfor %}
        </div>
        {% else %}
        <div class="alert alert-success mt-3">
          {% for message in msg %}
          <p>{{ message }}</p>
          {% endfor %}
        </div>
        {% if root is not None %} 
        <h4 class="mt-3">Raíz aproximada: <b>{{ root }}</b></h4> 
        {% endif %}
        {% endif %}
      </div>

      <!-- Gráfico -->
      {% if graph %}
      <div class="plot mt-4">
        <img src="data:image/png;base64,{{ graph }}" class="img-fluid shadow" alt="Graph of f(x)">
      </div>
      {% endif %}
    </div>
  </div>

  <!-- Tabla de Iteraciones -->
  {% if table %}
  <div class="row justify-content-center mt-5">
    <div class="col-lg-8">
      <h4>Tabla de Iteraciones ({{ error_type }}):</h4>
      <div class="table-responsive">
        <table class="table table-striped table-hover shadow-sm">
          <thead class="table-dark">
            <tr>
              <th>Iteración</th>
              <th>x_n</th>
              <th>f(x_n)</th>
              <th>{{ error_type }}</th>
            </tr>
          </thead>
          <tbody>
            {% for row in table %}
              <tr>
                <td>{{ row.iteration }}</td>
                <td>{{ row.x_n }}</td>
                <td>{{ row.fx_n }}</td>
                <td>{{ row.error }}</td>
              </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    </div>
  </div>
  {% endif %}

</div>

<!-- Sintaxis permitida -->
<div class="examples mt-5">
  <div class="row">
    <div class="col text-center">
      <h2>Sintaxis permitidas</h2>
      <div class="table-responsive">
        <table class="table table-bordered mx-auto shadow-sm" style="width: auto;">
          <thead class="table-light">
            <tr>
              <th>Nombre</th>
              <th>Sintaxis</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td>Constante Pi</td>
              <td><code>pi</code></td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
  </div>
</div>

<style>
  body {
    font-family: 'Poppins', sans-serif;
  }

  .table-bordered th, .table-bordered td {
    border: 1px solid #dee2e6;
  }
  .table-bordered th {
    background-color: #3a3b3b;
    color: white;
  }
  .card {
    border-radius: 1rem;
  }
  .btn-primary {
    background-color: #007bff;
    border-color: #007bff;
  }
</style>

{% endblock %}
